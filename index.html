<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Flipbook 173 Halaman</title>
  <link rel="icon" href="images/page1.jpg"> <!-- favicon biar ga 404 -->
  <script src="js/jquery.min.js"></script>
  <script src="js/turn.min.js"></script>
  <style>
    body {
      background: #000; 
      display: flex; 
      flex-direction: column;
      align-items: center;
      margin: 0;
      font-family: Arial, sans-serif;
      height: 100vh;
      overflow: hidden;
    }
    h1 { 
      text-align: center; 
      margin: 10px 0; 
      color: white;
      font-size: 18px;
    }

    .flipbook { 
      box-shadow: 0 4px 15px rgba(0,0,0,0.7); 
      background: white; 
      margin: auto; 
      position: relative;
    }
    .flipbook img { 
      width: 100%; 
      height: 100%; 
      object-fit: cover; 
    }
    .flipbook .page { 
      cursor: grab; 
      box-shadow: inset -2px 0 5px rgba(0,0,0,0.3);
    }
    .flipbook .page:active { cursor: grabbing; }

    .nav-buttons { 
      margin: 10px 0; 
      display: flex; 
      gap: 10px; 
    }
    button { 
      padding: 6px 12px; 
      font-size: 14px; 
      border: none; 
      border-radius: 5px; 
      background: #007bff; 
      color: white; 
      cursor: pointer; 
      transition: 0.3s; 
    }
    button:hover { background: #0056b3; }

    .pagination { 
      display: flex; 
      flex-wrap: wrap; 
      justify-content: center; 
      gap: 5px; 
      margin: 10px 0; 
    }
    .pagination button { 
      padding: 4px 8px; 
      border: 1px solid #007bff; 
      background: white; 
      color: #007bff; 
    }
    .pagination button.active { 
      background: #007bff; 
      color: white; 
    }

    .goto { 
      margin-bottom: 10px; 
      text-align: center; 
      color: white;
    }
    input[type="number"] { 
      width: 60px; 
      padding: 4px; 
    }
  </style>
</head>
<body>
  <h1>Laporan Rekonsiliasi BMD Tahun 2023</h1>

  <div class="flipbook" id="book"></div>

  <div class="nav-buttons">
    <button id="prev">⬅️</button>
    <button id="next">➡️</button>
  </div>

  <div class="pagination" id="pagination"></div>

  <div class="goto">
    <label for="gotoPage">Go to page: </label>
    <input type="number" id="gotoPage" min="1" max="173">
    <button id="gotoBtn">Go</button>
  </div>

  <!-- Audio flip -->
  <audio id="flip-sound" src="sounds/flip.mp3" preload="auto"></audio>

  <script>
    const totalPages = 173;
    const perBlock = 10;
    let currentBlock = 1;
    let soundEnabled = false;

    const flipSound = document.getElementById("flip-sound");
    const pagination = document.getElementById("pagination");

    // aktifkan sound setelah user interaksi pertama
    document.body.addEventListener("click", () => { soundEnabled = true; }, { once: true });

    // Tambah halaman otomatis
    function loadPages(target){
      for(let i=1;i<=totalPages;i++){
        const page = document.createElement("div");
        page.classList.add("page");
        const img = document.createElement("img");
        img.src = `images/page${i}.jpg`;
        page.appendChild(img);
        target.appendChild(page);
      }
    }
    loadPages(document.getElementById("book"));

    function initFlipbook(){
      // rasio A4 portrait (tinggi/lebar)
      const aspect = 842 / 595;

      let w = Math.min(window.innerWidth * 0.95, 1000);
      let h = w * aspect;

      if (h > window.innerHeight * 0.85) {
        h = window.innerHeight * 0.85;
        w = h / aspect;
      }

      $("#book").turn({
        width: w,
        height: h,
        autoCenter: true,
        display: "double", // selalu double
        when: {
          turned: function(e, page){
            if (soundEnabled) {
              flipSound.currentTime = 0; 
              flipSound.play().catch(()=>{});
            }
            highlightPage(page);
          }
        }
      });
    }

    // Resize → update ukuran
    $(window).on("resize", function(){
      const aspect = 842 / 595;
      let w = Math.min(window.innerWidth * 0.95, 1000);
      let h = w * aspect;

      if (h > window.innerHeight * 0.85) {
        h = window.innerHeight * 0.85;
        w = h / aspect;
      }

      $("#book").turn("size", w, h);
    });

    // Pagination
    function createPagination(block=1){
      pagination.innerHTML="";
      let start=(block-1)*perBlock+1;
      let end=Math.min(start+perBlock-1,totalPages);
      if(block>1){
        const prevBlock=document.createElement("button");
        prevBlock.textContent="«";
        prevBlock.addEventListener("click",()=>{currentBlock--; createPagination(currentBlock);});
        pagination.appendChild(prevBlock);
      }
      for(let i=start;i<=end;i++){
        const btn=document.createElement("button");
        btn.textContent=i;
        btn.addEventListener("click",()=>$("#book").turn("page",i));
        pagination.appendChild(btn);
      }
      if(end<totalPages){
        const nextBlock=document.createElement("button");
        nextBlock.textContent="»";
        nextBlock.addEventListener("click",()=>{currentBlock++; createPagination(currentBlock);});
        pagination.appendChild(nextBlock);
      }
      highlightPage($("#book").turn("page"));
    }

    function highlightPage(page){
      document.querySelectorAll(".pagination button").forEach(btn=>btn.classList.remove("active"));
      const idx = (page-1)%perBlock;
      const btns = document.querySelectorAll(".pagination button");
      if(btns[idx]) btns[idx].classList.add("active");
    }

    document.getElementById("prev").addEventListener("click",()=>$("#book").turn("previous"));
    document.getElementById("next").addEventListener("click",()=>$("#book").turn("next"));
    document.getElementById("gotoBtn").addEventListener("click",()=>{
      const p=parseInt(document.getElementById("gotoPage").value);
      if(p>=1 && p<=totalPages){
        $("#book").turn("page",p);
        const newBlock=Math.ceil(p/perBlock);
        if(newBlock!=currentBlock){currentBlock=newBlock; createPagination(currentBlock);}
      }
    });

    // Init
    initFlipbook();
    createPagination();
  </script>
</body>
</html>
