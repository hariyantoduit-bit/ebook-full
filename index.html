<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Flipbook Full</title>
  <link rel="icon" href="images/page1.jpg">
  <script src="js/jquery.min.js"></script>
  <script src="js/turn.min.js"></script>
  <style>
    body { 
      margin: 0;
      font-family: Arial, sans-serif;
      background: #000; /* background hitam */
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100vh;
      overflow: hidden;
    }
    h1 {
      color: #fff;
      text-align: center;
      margin: 10px 0;
      font-size: 18px;
    }
    .flipbook {
      background: #fff;
      box-shadow: 0 4px 15px rgba(0,0,0,0.6);
      margin: auto;
    }
    .flipbook .page img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .nav-buttons {
      margin: 8px 0;
      display: flex;
      gap: 10px;
    }
    button {
      padding: 6px 12px;
      font-size: 14px;
      border: none;
      border-radius: 4px;
      background: #007bff;
      color: #fff;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover { background: #0056b3; }
    .pagination {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 4px;
      margin: 10px 0;
    }
    .pagination button {
      padding: 4px 8px;
      border: 1px solid #007bff;
      background: white;
      color: #007bff;
    }
    .pagination button.active {
      background: #007bff;
      color: #fff;
    }
    .goto {
      margin-bottom: 15px;
      text-align: center;
      color: #fff;
    }
    .goto input[type="number"] {
      width: 60px;
      padding: 4px;
    }
  </style>
</head>
<body>
  <h1>Laporan Rekonsiliasi BMD Tahun 2023</h1>
  <div id="book" class="flipbook"></div>

  <div class="nav-buttons">
    <button id="prev">⬅️</button>
    <button id="next">➡️</button>
  </div>

  <div id="pagination" class="pagination"></div>

  <div class="goto">
    <label for="gotoPage">Go to page: </label>
    <input type="number" id="gotoPage" min="1">
    <button id="gotoBtn">Go</button>
  </div>

  <audio id="flip-sound" src="sounds/flip.mp3" preload="auto"></audio>

  <script>
    const totalPages = 173; // jumlah halaman
    const perBlock = 10;
    let currentBlock = 1;
    let soundEnabled = false;

    const book = document.getElementById("book");
    const flipSound = document.getElementById("flip-sound");
    const pagination = document.getElementById("pagination");

    // aktifkan sound setelah interaksi pertama
    document.body.addEventListener("click", () => { soundEnabled = true; }, { once: true });

    // load halaman
    function loadPages(target){
      for(let i=1; i<=totalPages; i++){
        const page = document.createElement("div");
        page.classList.add("page");
        const img = document.createElement("img");
        img.src = `images/page${i}.jpg`;
        page.appendChild(img);
        target.appendChild(page);
      }
    }
    loadPages(book);

    // init flipbook
    function initFlipbook(){
      const aspect = 842 / 595; // rasio A4 portrait
      let w = Math.min(window.innerWidth * 0.95, 900);
      let h = w * aspect;
      if (h > window.innerHeight * 0.85) {
        h = window.innerHeight * 0.85;
        w = h / aspect;
      }
      // cover depan & belakang single
      $("#book").turn({
        width: w,
        height: h,
        autoCenter: true,
        display: window.innerWidth < 768 ? "single" : "double",
        when: {
          turned: function(e, page){
            if (soundEnabled) {
              flipSound.currentTime = 0;
              flipSound.play().catch(()=>{});
            }
            highlightPage(page);
          }
        }
      });
    }

    // Pagination
    function createPagination(block=1){
      pagination.innerHTML="";
      let start=(block-1)*perBlock+1;
      let end=Math.min(start+perBlock-1,totalPages);
      if(block>1){
        const prevBlock=document.createElement("button");
        prevBlock.textContent="«";
        prevBlock.addEventListener("click",()=>{currentBlock--; createPagination(currentBlock);});
        pagination.appendChild(prevBlock);
      }
      for(let i=start;i<=end;i++){
        const btn=document.createElement("button");
        btn.textContent=i;
        btn.addEventListener("click",()=>$("#book").turn("page",i));
        pagination.appendChild(btn);
      }
      if(end<totalPages){
        const nextBlock=document.createElement("button");
        nextBlock.textContent="»";
        nextBlock.addEventListener("click",()=>{currentBlock++; createPagination(currentBlock);});
        pagination.appendChild(nextBlock);
      }
      highlightPage($("#book").turn("page"));
    }

    function highlightPage(page){
      document.querySelectorAll(".pagination button").forEach(btn=>btn.classList.remove("active"));
      const idx = (page-1)%perBlock;
      const btns = document.querySelectorAll(".pagination button");
      if(btns[idx]) btns[idx].classList.add("active");
    }

    // tombol
    document.getElementById("prev").addEventListener("click",()=>$("#book").turn("previous"));
    document.getElementById("next").addEventListener("click",()=>$("#book").turn("next"));
    document.getElementById("gotoBtn").addEventListener("click",()=>{
      const p=parseInt(document.getElementById("gotoPage").value);
      if(p>=1 && p<=totalPages){
        $("#book").turn("page",p);
        const newBlock=Math.ceil(p/perBlock);
        if(newBlock!=currentBlock){currentBlock=newBlock; createPagination(currentBlock);}
      }
    });

    // init pertama
    initFlipbook();
    createPagination();

    // resize responsif
    $(window).on("resize", function(){
      const aspect = 842 / 595;
      let w = Math.min(window.innerWidth * 0.95, 900);
      let h = w * aspect;
      if (h > window.innerHeight * 0.85) {
        h = window.innerHeight * 0.85;
        w = h / aspect;
      }
      $("#book").turn("size", w, h);
      $("#book").turn("display", window.innerWidth < 768 ? "single" : "double");
    });

    // auto fullscreen di HP
    if (/Mobi|Android/i.test(navigator.userAgent)) {
      document.addEventListener("DOMContentLoaded", () => {
        document.documentElement.requestFullscreen?.();
      });
    }
  </script>
</body>
</html>
